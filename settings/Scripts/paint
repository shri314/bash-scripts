#!/bin/bash
exec -a "$0" gawk -f <(sed -n '/^\#gawk/,$p' "$0") "$@"
exit $?

#gawk -f

#
#Author   : Shriram V
#Email    : shri314@yahoo.com
#Comments : Colors the output of any command
#

BEGIN {
   RES=system("isatty output");
   CVSCMD=0;
}

{
   if(ENVIRON["FORCE_COLOR"] == "1")
   {
   }
   else
   {
      if(RES == 0)
      {
         print;
         fflush("");
         next;
      }
   }
}

/^[UPTD?] / {
   $0 = gensub(/^(.)/,   "[01;32m\\1[00m", 1);
   CVSCMD=1;
}

/^[AR] / {
   $0 = gensub(/^(.)/,   "[33;44m\\1[00m", 1);
   CVSCMD=1;
}

/^M / {
   $0 = gensub(/^(.)/,   "[01;35m\\1[00m", 1);
   CVSCMD=1;
}

/^C / {
   $0 = gensub(/^(.)/,   "[01;41m\\1[00m", 1);
   CVSCMD=1;
}

/^G / {
   $0 = gensub(/^(.)/,   "[30;43m\\1[00m", 1);
   CVSCMD=1;
}

/^Index: / {
   $0 = gensub(/^.*$/,   "[01;32m\\0[00m", 1); 
   CVSCMD=1;
}

/^[-][-][-] / {
   $0 = gensub(/^.*$/,   "[01;32m\\0[00m", 1); 
   CVSCMD=1;
}

/^[+][+][+] / {
   $0 = gensub(/^.*$/,   "[01;32m\\0[00m", 1); 
   CVSCMD=1;
}

/^@@ .* @@$/ {
   $0 = gensub(/^.*$/,   "[01;33m\\0[00m", 1); 
   CVSCMD=1;
}

/^[-][^-]?/ {
   $0 = gensub(/^.*$/,   "[01;31m\\0[00m", 1);
   CVSCMD=1;
}

/^[+][^+]?/ {
   $0 = gensub(/^.*$/,   "[01;36m\\0[00m", 1); 
   CVSCMD=1;
}

{
   if(CVSCMD == 1)
   {
      CVSCMD = 0;
      print;
      fflush("");
      next;
   }
}

/[^:]*:[0-9]+/ {
   $0 = gensub(/:([0-9]+)/,               ":[01;31m\\1[00m",     "g");
}

/^make/ {
   $0 = gensub(/([[][^ ]*)[]]/,             "[01;33m\\1[00m[01;33m][00m",     "g");
   $0 = gensub(/(make)/,                    "[01;32m\\1[00m",                     "g");
   $0 = gensub(/(directory `)(\/[^']*)'/,   "\\1[01;34m\\2[00m'",                 "g");
}

{
   $0 = gensub(/(-o  *)([\/._a-zA-Z0-9-]*)/,      "\\1[01;32m\\2[00m", "g");
   $0 = gensub(/ (-[a-zA-Z-][^ ]*)/,              " [01;35m\\1[00m", "g");
   $0 = gensub(/([\/.a-zA-Z_-]*\<gcc) /,          "[01;32m\\1[00m ", "g");
   $0 = gensub(/([\/.a-zA-Z_-]*\<gcj) /,          "[01;32m\\1[00m ", "g");
   $0 = gensub(/([\/.a-zA-Z_-]*\<g[+][+]) /,      "[01;32m\\1[00m ", "g");
   $0 = gensub(/([\/.a-zA-Z_-]*\<clang) /,        "[01;32m\\1[00m ", "g");
   $0 = gensub(/([\/.a-zA-Z_-]*\<clang[+][+]) /,  "[01;32m\\1[00m ", "g");
   $0 = gensub(/([\/.a-zA-Z_-]*\<cc) /,           "[01;32m\\1[00m ", "g");
   $0 = gensub(/([\/.a-zA-Z_-]*\<distcc) /,       "[01;32m\\1[00m ", "g");
   $0 = gensub(/([\/.a-zA-Z_-]*\<ccache) /,       "[01;32m\\1[00m ", "g");
   $0 = gensub(/([\/.a-zA-Z_-]*\<java) /,         "[01;32m\\1[00m ", "g");
   $0 = gensub(/([\/.a-zA-Z_-]*\<javac) /,        "[01;32m\\1[00m ", "g");
   $0 = gensub(/([\/.a-zA-Z_-]*\<cp) /,           "[01;32m\\1[00m ", "g");
   $0 = gensub(/([\/.a-zA-Z_-]*\<install) /,      "[01;32m\\1[00m ", "g");
   $0 = gensub(/([\/.a-zA-Z_-]*\<libtool) /,      "[01;32m\\1[00m ", "g");
   $0 = gensub(/([\/.a-zA-Z_-]*\<ranlib) /,       "[01;32m\\1[00m ", "g");
   $0 = gensub(/([\/.a-zA-Z_-]*\<ar) /,           "[01;32m\\1[00m ", "g");
   $0 = gensub(/([\/.a-zA-Z_-]*\<bash) /,         "[01;32m\\1[00m ", "g");
   $0 = gensub(/([\/.a-zA-Z_-]*\<sh) /,           "[01;32m\\1[00m ", "g");
   $0 = gensub(/([\/.a-zA-Z_-]*\<mkdir) /,        "[01;32m\\1[00m ", "g");
   $0 = gensub(/([\/.a-zA-Z_-]*\<rm) /,           "[01;32m\\1[00m ", "g");
   $0 = gensub(/([\/.a-zA-Z_-]*\<mv) /,           "[01;32m\\1[00m ", "g");
   $0 = gensub(/([\/.a-zA-Z_-]*\<test) /,         "[01;32m\\1[00m ", "g");
   $0 = gensub(/([\/.a-zA-Z_-]*\<echo) /,         "[01;32m\\1[00m ", "g");

   $0 = gensub(/Can.t locate/,                  "[01;33m\\0[00m", "g");
   $0 = gensub(/cannot find/,                   "[01;33m\\0[00m", "g");

   $0 = gensub(/^([[:alnum:]/._+-]+[.][Cc])\>/,               "[00;31m\\0[00m", "g");
   $0 = gensub(/^([[:alnum:]/._+-]+[.][Hh])\>/,               "[00;31m\\0[00m", "g");
   $0 = gensub(/^([[:alnum:]/._+-]+[.][Cc][Cc])\>/,           "[00;31m\\0[00m", "g");
   $0 = gensub(/^([[:alnum:]/._+-]+[.][Hh][Hh])\>/,           "[00;31m\\0[00m", "g");
   $0 = gensub(/^([[:alnum:]/._+-]+[.][Cc][Pp][Pp])\>/,       "[00;31m\\0[00m", "g");
   $0 = gensub(/^([[:alnum:]/._+-]+[.][Hh][Pp][Pp])\>/,       "[00;31m\\0[00m", "g");
   $0 = gensub(/^([[:alnum:]/._+-]+[.][Ii][Nn][Ll])\>/,       "[00;31m\\0[00m", "g");
   $0 = gensub(/^([[:alnum:]/._+-]+[.][Jj][Aa][Vv][Aa])\>/,   "[00;31m\\0[00m", "g");

   $0 = gensub(/([[:alnum:]/._+-]+[.][Tt][Cc][Cc])\>[:]/,     "[00;31m\\0[00m:", 1);
   $0 = gensub(/(\/usr\/[[:alnum:]/._+-]+)\>[:]/,             "[00;31m\\1[00m:", 1);

   $0 = gensub(/(\<AR\>)/,                                    "[01;32m\\1[00m", "g");
   $0 = gensub(/(\<CC\>)/,                                    "[01;32m\\1[00m", "g");
   $0 = gensub(/(\<RM\>)/,                                    "[01;32m\\1[00m", "g");
   $0 = gensub(/(\<MV\>)/,                                    "[01;32m\\1[00m", "g");
   $0 = gensub(/(\<CP\>)/,                                    "[01;32m\\1[00m", "g");
   $0 = gensub(/(\<LD\>)/,                                    "[01;32m\\1[00m", "g");
   $0 = gensub(/(\<GEN\>)/,                                   "[01;32m\\1[00m", "g");
   $0 = gensub(/(\<CCLD\>)/,                                  "[01;32m\\1[00m", "g");
   $0 = gensub(/(\<CXX\>)/,                                   "[01;32m\\1[00m", "g");
   $0 = gensub(/(\<RANLIB\>)/,                                "[01;32m\\1[00m", "g");
   $0 = gensub(/(\<CXXLD\>)/,                                 "[01;32m\\1[00m", "g");
   $0 = gensub(/(\<CLEAN\>)/,                                 "[01;32m\\1[00m", "g");
   $0 = gensub(/(\<MKDIR\>)/,                                 "[01;32m\\1[00m", "g");
   $0 = gensub(/(\<INSTALL\>)/,                               "[01;32m\\1[00m", "g");
   $0 = gensub(/(\<LINK\>)/,                                  "[01;32m\\1[00m", "g");
   $0 = gensub(/(\<CLANG\>)/,                                 "[01;32m\\1[00m", "g");

   $0 = gensub(/(\<[pP][aA][sS][sS]\>)/ ,                     "[01;32m\\1[00m", "g");
   $0 = gensub(/(\<[pP][aA][sS][sS][eE][dD]\>)/ ,             "[01;32m\\1[00m", "g");
   $0 = gensub(/(\<[fF][aA][iI][lL]\>)/,                      "[01;33m[41m\\1[00m", "g");
   $0 = gensub(/(\<[eE][rR][rR][oO][rR]\>)/,                  "[01;33m[41m\\1[00m", "g");
   $0 = gensub(/(\<[eE][rR][rR][oO][rR][sS]\>)/,              "[01;33m[41m\\1[00m", "g");
   $0 = gensub(/(\<[fF][aA][tT][aA][lL]\>)/,                  "[01;33m[41m\\1[00m", "g");
   $0 = gensub(/(\<[fF][aA][iI][lL][eE][dD]\>)/,              "[01;33m[41m\\1[00m", "g");
   $0 = gensub(/(\<[fF][aA][iI][lL][uU][rR][eE]\>)/,          "[01;33m[41m\\1[00m", "g");
   $0 = gensub(/([!][!][!][fF][aA][^!]*[!][!][!])/,           "[01;33m[44m\\1[00m", "g");
   $0 = gensub(/(^[0-9][0-9]*[)][ ].*)/,                      "[01;33m[44m\\1[00m", "g");
   $0 = gensub(/(\<[fF][aA][tT][aA][lL]\>)/,                  "[01;33m[41m\\1[00m", "g");
   $0 = gensub(/(\<[nN][oO][tT][iI][cC][eE]\>)/,              "[01;33m\\0[00m", "g");
   $0 = gensub(/(\<[aA][sS][sS][eE][rR][tT][^[:space:]]*\>)/, "[01;33m\\1[00m", "g");

   $0 = gensub(/([#][[:space:]]*include[[:space:]]*)([<"][^>""]*[>"])/,  "[00;36m\\1[00m[00;35m\\2[00m", "g");
   $0 = gensub(/[""]([^""\\]|\\.)*[""]/,                      "[00;35m\\0[00m", "g");

   $0 = gensub(/\<void\>/,      "[01;32m\\0[00m", "g");
   $0 = gensub(/\<bool\>/,      "[01;32m\\0[00m", "g");
   $0 = gensub(/\<byte\>/,      "[01;32m\\0[00m", "g");
   $0 = gensub(/\<char\>/,      "[01;32m\\0[00m", "g");
   $0 = gensub(/\<char8_t\>/,   "[01;32m\\0[00m", "g");
   $0 = gensub(/\<char16_t\>/,  "[01;32m\\0[00m", "g");
   $0 = gensub(/\<char32_t\>/,  "[01;32m\\0[00m", "g");
   $0 = gensub(/\<wchar_t\>/,   "[01;32m\\0[00m", "g");
   $0 = gensub(/\<int\>/,       "[01;32m\\0[00m", "g");
   $0 = gensub(/\<int16_t\>/,   "[01;32m\\0[00m", "g");
   $0 = gensub(/\<int32_t\>/,   "[01;32m\\0[00m", "g");
   $0 = gensub(/\<int62_t\>/,   "[01;32m\\0[00m", "g");
   $0 = gensub(/\<intptr_t\>/,  "[01;32m\\0[00m", "g");
   $0 = gensub(/\<uint16_t\>/,  "[01;32m\\0[00m", "g");
   $0 = gensub(/\<uint32_t\>/,  "[01;32m\\0[00m", "g");
   $0 = gensub(/\<uint62_t\>/,  "[01;32m\\0[00m", "g");
   $0 = gensub(/\<uintptr_t\>/, "[01;32m\\0[00m", "g");
   $0 = gensub(/\<ptrdiff_t\>/, "[01;32m\\0[00m", "g");
   $0 = gensub(/\<short\>/,     "[01;32m\\0[00m", "g");
   $0 = gensub(/\<long\>/,      "[01;32m\\0[00m", "g");
   $0 = gensub(/\<float\>/,     "[01;32m\\0[00m", "g");
   $0 = gensub(/\<double\>/,    "[01;32m\\0[00m", "g");
   $0 = gensub(/\<size_t\>/,    "[01;32m\\0[00m", "g");
   $0 = gensub(/\<ssize_t\>/,   "[01;32m\\0[00m", "g");
   $0 = gensub(/\<auto\>/,      "[01;32m\\0[00m", "g");

   $0 = gensub(/\<constexpr\>/, "[01;32m\\0[00m", "g");
   $0 = gensub(/\<const\>/,     "[01;32m\\0[00m", "g");
   $0 = gensub(/\<override\>/,  "[01;32m\\0[00m", "g");
   $0 = gensub(/\<concept\>/,   "[01;32m\\0[00m", "g");
   $0 = gensub(/\<unsigned\>/,  "[01;32m\\0[00m", "g");
   $0 = gensub(/\<signed\>/,    "[01;32m\\0[00m", "g");
   $0 = gensub(/\<typedef\>/,   "[01;32m\\0[00m", "g");
   $0 = gensub(/\<typename\>/,  "[01;32m\\0[00m", "g");
   $0 = gensub(/\<external\>/,  "[01;32m\\0[00m", "g");
   $0 = gensub(/\<template\>/,  "[01;32m\\0[00m", "g");
   $0 = gensub(/\<class\>/,     "[01;32m\\0[00m", "g");
   $0 = gensub(/\<struct\>/,    "[01;32m\\0[00m", "g");
   $0 = gensub(/\<union\>/,     "[01;32m\\0[00m", "g");
   $0 = gensub(/\<namespace\>/, "[01;32m\\0[00m", "g");
   $0 = gensub(/(^|[ :])(\<static\>)([ ]|$)/,    "\\1[01;32m\\2[00m\\3", "g");
   $0 = gensub(/\<virtual\>/,   "[01;32m\\0[00m", "g");

   $0 = gensub(/\<this\>/,      "[01;33m\\0[00m", "g");
   $0 = gensub(/\<typeid\>/,    "[01;33m\\0[00m", "g");
   $0 = gensub(/\<sizeof\>/,    "[01;33m\\0[00m", "g");
   $0 = gensub(/\<try\>/,       "[01;33m\\0[00m", "g");
   $0 = gensub(/\<throw\>/,     "[01;33m\\0[00m", "g");
   $0 = gensub(/\<catch\>/,     "[01;33m\\0[00m", "g");
   $0 = gensub(/\<if\>/,        "[01;33m\\0[00m", "g");
   $0 = gensub(/\<then\>/,      "[01;33m\\0[00m", "g");
   $0 = gensub(/\<else\>/,      "[01;33m\\0[00m", "g");
   $0 = gensub(/\<elif\>/,      "[01;33m\\0[00m", "g");
   $0 = gensub(/\<switch\>/,    "[01;33m\\0[00m", "g");
   $0 = gensub(/\<case\>/,      "[01;33m\\0[00m", "g");
   $0 = gensub(/\<esac\>/,      "[01;33m\\0[00m", "g");
   $0 = gensub(/\<done\>/,      "[01;33m\\0[00m", "g");
   $0 = gensub(/\<fi\>/,        "[01;33m\\0[00m", "g");
   $0 = gensub(/\<do\>/,        "[01;33m\\0[00m", "g");
   $0 = gensub(/\<for\>/,       "[01;33m\\0[00m", "g");
   $0 = gensub(/\<while\>/,     "[01;33m\\0[00m", "g");
   $0 = gensub(/\<const_cast\>/,       "[01;33m\\0[00m", "g");
   $0 = gensub(/\<dynamic_cast\>/,     "[01;33m\\0[00m", "g");
   $0 = gensub(/\<reinterpret_cast\>/, "[01;33m\\0[00m", "g");
   $0 = gensub(/\<static_assert\>/,    "[01;33m\\0[00m", "g");
   $0 = gensub(/\<static_cast\>/,      "[01;33m\\0[00m", "g");
   $0 = gensub(/\<operator\>/,  "[01;33m\\0[00m", "g");
   $0 = gensub(/\<new\>/,       "[01;33m\\0[00m", "g");
   $0 = gensub(/\<delete\>/,    "[01;33m\\0[00m", "g");
   $0 = gensub(/\<return\>/,    "[01;33m\\0[00m", "g");
   $0 = gensub(/\<co_async\>/,  "[01;33m\\0[00m", "g");
   $0 = gensub(/\<co_yield\>/,  "[01;33m\\0[00m", "g");
   $0 = gensub(/\<co_return\>/, "[01;33m\\0[00m", "g");
   $0 = gensub(/\<decltype\>/,  "[01;33m\\0[00m", "g");
   $0 = gensub(/\<using\>/,     "[01;33m\\0[00m", "g");
   $0 = gensub(/(^|[ :])(\<public\>)([: ]|$)/,    "\\1[01;33m\\2[00m\\3", "g");
   $0 = gensub(/(^|[ :])(\<private\>)([: ]|$)/,   "\\1[01;33m\\2[00m\\3", "g");
   $0 = gensub(/(^|[ :])(\<protected\>)([: ]|$)/, "\\1[01;33m\\2[00m\\3", "g");
   $0 = gensub(/\<requires\>/,  "[01;33m\\0[00m", "g");

   $0 = gensub(/\<true\>/,      "[00;35m\\0[00m", "g");
   $0 = gensub(/\<false\>/,     "[00;35m\\0[00m", "g");
   $0 = gensub(/\<nullptr\>/,   "[00;35m\\0[00m", "g");

   $0 = gensub(/\<or\>/,        "[01;33m\\0[00m", "g");
   $0 = gensub(/\<and\>/,       "[01;33m\\0[00m", "g");
   $0 = gensub(/\<not\>/,       "[01;33m\\0[00m", "g");

   $0 = gensub(/\/\/.*/,        "[00;36m\\0[00m", "g");
   print;
   fflush("");
}
